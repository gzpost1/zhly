<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.cuiot.dmp.externalapi.service.mapper.video.VideoPlayMapper">

    <select id="queryForPage" parameterType="cn.cuiot.dmp.externalapi.service.entity.video.query.VideoPageQuery"
            resultType="cn.cuiot.dmp.externalapi.service.entity.video.vo.VideoPageVo">
        SELECT
            a.device_id,
            a.device_name,
            a.state,
            a.device_type,
            b.flv
        FROM
            (
            SELECT
                device_id,
                device_name,
                state,
                device_type
            from
                tb_video_device
            WHERE
                deleted = 0
                AND company_id = #{params.companyId}
            <if test="params.deviceName != null and params.deviceName !=''">
                AND device_name LIKE CONCAT('%', #{params.deviceName}, '%')
            </if>
            )a
        LEFT JOIN
            tb_video_play b ON a.device_id = b.device_id AND b.deleted = 0
        GROUP BY
            a.device_id
    </select>
</mapper>